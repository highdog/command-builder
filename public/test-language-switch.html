<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>测试语言切换保持命令选择</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .test-section {
            margin: 2rem 0;
            padding: 1rem;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            background: #f8f9fa;
        }
        
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            margin: 0.25rem;
        }
        
        button:hover {
            background: #0056b3;
        }
        
        .lang-switch {
            background: #28a745;
        }
        
        .lang-switch:hover {
            background: #1e7e34;
        }
        
        select {
            padding: 0.5rem;
            margin: 0.5rem;
            border: 1px solid #ccc;
            border-radius: 4px;
            min-width: 200px;
        }
        
        .status {
            padding: 1rem;
            border-radius: 4px;
            margin: 1rem 0;
        }
        
        .success { background: #d4edda; color: #155724; }
        .info { background: #d1ecf1; color: #0c5460; }
        .warning { background: #fff3cd; color: #856404; }
    </style>
</head>
<body>
    <div class="container">
        <h1>🔄 测试语言切换保持命令选择</h1>
        
        <div class="status info">
            <h3>测试说明</h3>
            <p>1. 选择一个命令</p>
            <p>2. 切换语言</p>
            <p>3. 验证命令选择是否保持不变</p>
        </div>
        
        <div class="test-section">
            <h3>语言控制</h3>
            <button class="lang-switch" onclick="window.parent.postMessage({action: 'switchLanguage', lang: 'zh'}, '*')">切换到中文</button>
            <button class="lang-switch" onclick="window.parent.postMessage({action: 'switchLanguage', lang: 'en'}, '*')">Switch to English</button>
            <p><strong>当前语言:</strong> <span id="current-lang">加载中...</span></p>
        </div>
        
        <div class="test-section">
            <h3>测试步骤</h3>
            <ol>
                <li>在主页面选择一个命令（如"Get Device Type"）</li>
                <li>观察命令构建区域显示的内容</li>
                <li>点击上方的语言切换按钮</li>
                <li>验证：
                    <ul>
                        <li>✅ 命令选择下拉框仍然选中相同的命令</li>
                        <li>✅ 命令构建区域的文字已切换到新语言</li>
                        <li>✅ 界面其他部分的文字也已切换</li>
                    </ul>
                </li>
            </ol>
        </div>
        
        <div class="test-section">
            <h3>预期行为</h3>
            <div class="status success">
                <p><strong>✅ 正确行为：</strong></p>
                <ul>
                    <li>命令选择保持不变</li>
                    <li>界面文字立即切换</li>
                    <li>命令构建区域内容更新为新语言</li>
                </ul>
            </div>
            
            <div class="status warning">
                <p><strong>❌ 错误行为（已修复）：</strong></p>
                <ul>
                    <li>命令选择被重置为"请选择命令"</li>
                    <li>需要重新选择命令</li>
                </ul>
            </div>
        </div>
        
        <div class="test-section">
            <h3>技术实现</h3>
            <p>修复方法：在<code>renderCommandSelect()</code>函数中：</p>
            <pre style="background: #f8f9fa; padding: 1rem; border-radius: 4px; overflow-x: auto;">
// 保存当前选择的值
const currentValue = commandSelect.value;

// 重新渲染选项...

// 恢复之前选择的值
if (currentValue) {
    commandSelect.value = currentValue;
}</pre>
        </div>
    </div>

    <script>
        // 监听来自父页面的消息
        window.addEventListener('message', function(event) {
            if (event.data.action === 'languageChanged') {
                updateLanguageDisplay(event.data.lang);
            }
        });
        
        function updateLanguageDisplay(lang) {
            const display = document.getElementById('current-lang');
            if (display) {
                display.textContent = lang === 'zh' ? '中文' : 'English';
            }
        }
        
        // 初始化显示
        updateLanguageDisplay('zh');
    </script>
</body>
</html>
