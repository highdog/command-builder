<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>最终多语言测试</title>
    <script src="i18n.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .language-toggle {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 2rem;
            align-items: center;
        }
        
        .language-btn {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            color: #333;
            padding: 0.5rem 1rem;
            cursor: pointer;
            border-radius: 4px;
        }
        
        .language-btn.active {
            background: #007bff;
            color: white;
            border-color: #007bff;
        }
        
        .test-section {
            margin: 2rem 0;
            padding: 1rem;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            background: #f8f9fa;
        }
        
        .nav-demo {
            display: flex;
            gap: 1rem;
            padding: 1rem;
            background: #e9ecef;
            border-radius: 4px;
            margin: 1rem 0;
        }
        
        .nav-demo a {
            text-decoration: none;
            color: #007bff;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            background: white;
        }
        
        .form-demo {
            padding: 1rem;
            background: white;
            border-radius: 4px;
            margin: 1rem 0;
        }
        
        .form-group {
            margin: 1rem 0;
        }
        
        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold;
        }
        
        select, input {
            padding: 0.5rem;
            border: 1px solid #ccc;
            border-radius: 4px;
            width: 200px;
        }
        
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            margin: 0.25rem;
        }
        
        button:hover {
            background: #0056b3;
        }
        
        .status {
            padding: 1rem;
            border-radius: 4px;
            margin: 1rem 0;
        }
        
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <div class="container">
        <h1 data-i18n="pageTitle">最终多语言测试</h1>
        
        <div class="language-toggle">
            <span>语言 / Language:</span>
            <button class="language-btn active" data-lang="zh">中文</button>
            <button class="language-btn" data-lang="en">English</button>
        </div>
        
        <div class="test-section">
            <h2>导航栏测试 / Navigation Test</h2>
            <div class="nav-demo">
                <a href="#" data-i18n="nav.commandBuilder">Command Builder</a>
                <a href="#" data-i18n="nav.documentation">Documentation</a>
            </div>
        </div>
        
        <div class="test-section">
            <h2>表单元素测试 / Form Elements Test</h2>
            <div class="form-demo">
                <div class="form-group">
                    <label data-i18n="main.protocolLabel">蓝牙协议:</label>
                    <select>
                        <option data-i18n="protocols.gatt">GATT (BLE)</option>
                        <option data-i18n="protocols.rfcomm">RFCOMM</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label data-i18n="main.commandLabel">选择命令:</label>
                    <select>
                        <option data-i18n="main.selectCommand">-- 请稍候 --</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label data-i18n="command.packetType">数据包类型:</label>
                    <select>
                        <option value="0">COMMAND</option>
                        <option value="2">RESPONSE</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <input type="search" data-i18n="sidebar.searchPlaceholder" placeholder="搜索命令...">
                </div>
            </div>
        </div>
        
        <div class="test-section">
            <h2>按钮和操作测试 / Buttons and Actions Test</h2>
            <button data-i18n="main.copyButton">复制</button>
            <button data-i18n="actions.save">保存</button>
            <button data-i18n="actions.cancel">取消</button>
            <button data-i18n="actions.refresh">刷新</button>
        </div>
        
        <div class="test-section">
            <h2>API测试 / API Test</h2>
            <button onclick="testAPI()">测试API多语言支持</button>
            <div id="api-results" class="status info">点击按钮测试API...</div>
        </div>
        
        <div class="test-section">
            <h2>动态标签测试 / Dynamic Labels Test</h2>
            <button onclick="createDynamicLabels()">创建动态标签</button>
            <button onclick="testDynamicUpdate()">测试动态更新</button>
            <div id="dynamic-container"></div>
        </div>
        
        <div class="test-section">
            <h2>测试结果 / Test Results</h2>
            <div id="test-results" class="status info">
                <h3>测试状态 / Test Status</h3>
                <div id="results-content">准备开始测试...</div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const languageButtons = document.querySelectorAll('.language-btn');
            const resultsContent = document.getElementById('results-content');
            const apiResults = document.getElementById('api-results');
            const dynamicContainer = document.getElementById('dynamic-container');
            
            // Set initial language state
            const currentLang = i18nManager.getCurrentLanguage();
            languageButtons.forEach(btn => {
                btn.classList.toggle('active', btn.dataset.lang === currentLang);
            });
            
            // Apply initial language
            i18nManager.updatePageTexts();
            i18nManager.updateHtmlLang();
            
            // Language toggle functionality
            languageButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    const newLang = btn.dataset.lang;
                    const oldLang = i18nManager.getCurrentLanguage();
                    
                    if (newLang !== oldLang) {
                        i18nManager.setLanguage(newLang);
                        
                        // Update button states
                        languageButtons.forEach(b => {
                            b.classList.toggle('active', b.dataset.lang === newLang);
                        });
                        
                        // Update all texts
                        i18nManager.updatePageTexts();
                        i18nManager.updateHtmlLang();
                        
                        // Update dynamic labels
                        updateDynamicLabels();
                        
                        resultsContent.innerHTML = `语言已切换: ${oldLang} → ${newLang}<br>Language switched: ${oldLang} → ${newLang}`;
                    }
                });
            });
            
            // Test functions
            window.testAPI = async () => {
                apiResults.innerHTML = '正在测试API...';
                apiResults.className = 'status info';
                
                try {
                    const currentLang = i18nManager.getCurrentLanguage();
                    const response = await fetch(`/api/commands?lang=${currentLang}`);
                    
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}`);
                    }
                    
                    const data = await response.json();
                    const categories = Object.keys(data);
                    const totalCommands = Object.values(data).reduce((sum, cmds) => sum + cmds.length, 0);
                    
                    apiResults.innerHTML = `
                        ✅ API测试成功！<br>
                        语言: ${currentLang}<br>
                        分类数: ${categories.length}<br>
                        命令总数: ${totalCommands}<br>
                        示例分类: "${categories[0]}"<br>
                        示例命令: "${data[categories[0]][0].name}"
                    `;
                    apiResults.className = 'status success';
                    
                } catch (error) {
                    apiResults.innerHTML = `❌ API测试失败: ${error.message}`;
                    apiResults.className = 'status error';
                }
            };
            
            window.createDynamicLabels = () => {
                const currentLang = i18nManager.getCurrentLanguage();
                dynamicContainer.innerHTML = `
                    <div class="form-demo">
                        <div class="form-group">
                            <label for="field-packet-type-test">数据包类型:</label>
                            <select id="field-packet-type-test">
                                <option value="0">COMMAND</option>
                                <option value="2">RESPONSE</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="field-device-type-test">设备型号:</label>
                            <select id="field-device-type-test">
                                <option value="0x00">VERIO_100</option>
                                <option value="0x01">VERIO_200</option>
                            </select>
                        </div>
                    </div>
                `;
                
                resultsContent.innerHTML += `<br>动态标签已创建 (${currentLang})`;
            };
            
            window.testDynamicUpdate = () => {
                updateDynamicLabels();
                resultsContent.innerHTML += `<br>动态标签已更新`;
            };
            
            function updateDynamicLabels() {
                const currentLang = i18nManager.getCurrentLanguage();
                
                // Update packet type labels
                const packetTypeLabels = document.querySelectorAll('label[for*="field-packet-type"]');
                packetTypeLabels.forEach(label => {
                    label.textContent = i18nManager.t('command.packetType') + ':';
                });
                
                // Update device type labels
                const deviceTypeLabels = document.querySelectorAll('label[for*="field-device-type"]');
                deviceTypeLabels.forEach(label => {
                    const deviceTypeText = currentLang === 'zh' ? '设备型号:' : 'Device Type:';
                    label.textContent = deviceTypeText;
                });
            }
            
            resultsContent.innerHTML = `多语言系统已初始化，当前语言: ${currentLang}`;
        });
    </script>
</body>
</html>
