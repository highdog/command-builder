<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>命令文档语言切换测试</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        
        .test-container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            align-items: center;
        }
        
        .language-toggle {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .language-btn {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            color: #333;
            padding: 0.5rem 1rem;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
            border-radius: 4px;
        }
        
        .language-btn.active {
            background: #007bff;
            color: white;
            border-color: #007bff;
        }
        
        .command-select {
            padding: 0.5rem;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        
        .doc-container {
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 1rem;
            min-height: 200px;
            background: #fafafa;
        }
        
        .debug-panel {
            background: #e7f3ff;
            padding: 1rem;
            border-radius: 4px;
            margin-top: 1rem;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>命令文档语言切换测试</h1>
        
        <div class="controls">
            <div class="language-toggle">
                <span>语言:</span>
                <button class="language-btn active" data-lang="zh">中文</button>
                <button class="language-btn" data-lang="en">English</button>
            </div>
            
            <select class="command-select" id="command-select">
                <option value="">-- 选择命令 --</option>
                <option value="0x00">0x00 - 设备类型</option>
                <option value="0x02">0x02 - 序列号</option>
                <option value="0x03">0x03 - 功能版本</option>
            </select>
        </div>
        
        <div class="doc-container" id="command-display-container">
            <p>请选择一个命令查看文档</p>
        </div>
        
        <div class="debug-panel" id="debug-panel">
            调试信息将显示在这里...
        </div>
    </div>

    <script>
        // Mock command data with Chinese and English descriptions
        const mockCommands = {
            '0x00': {
                hex_id: '0x00',
                name_zh: '获取设备类型',
                name_en: 'Get Device Type',
                description_zh: `# 获取设备类型

这个命令用于获取蓝牙设备的类型信息。

## 功能说明
- 返回设备的具体类型
- 支持多种设备类别识别
- 用于设备兼容性检查

## 参数
- 无需参数

## 返回值
- 设备类型代码 (uint8)
- 0x01: 耳机
- 0x02: 音箱
- 0x03: 其他设备`,
                description_en: `# Get Device Type

This command is used to get the type information of the Bluetooth device.

## Function Description
- Returns the specific type of the device
- Supports multiple device category identification
- Used for device compatibility checking

## Parameters
- No parameters required

## Return Value
- Device type code (uint8)
- 0x01: Headphones
- 0x02: Speaker
- 0x03: Other devices`
            },
            '0x02': {
                hex_id: '0x02',
                name_zh: '获取序列号',
                name_en: 'Get Serial Number',
                description_zh: `# 获取序列号

获取设备的唯一序列号标识。

## 功能说明
- 返回设备的唯一标识符
- 用于设备追踪和管理
- 序列号格式为ASCII字符串

## 参数
- 无需参数

## 返回值
- 序列号字符串 (最大16字节)`,
                description_en: `# Get Serial Number

Get the unique serial number identifier of the device.

## Function Description
- Returns the unique identifier of the device
- Used for device tracking and management
- Serial number format is ASCII string

## Parameters
- No parameters required

## Return Value
- Serial number string (maximum 16 bytes)`
            },
            '0x03': {
                hex_id: '0x03',
                name_zh: '获取功能版本',
                name_en: 'Get Feature Version',
                description_zh: `# 获取功能版本

获取设备支持的功能版本信息。

## 功能说明
- 返回设备固件版本
- 显示支持的功能列表
- 用于功能兼容性判断

## 参数
- 无需参数

## 返回值
- 主版本号 (uint8)
- 次版本号 (uint8)
- 修订版本号 (uint16)`,
                description_en: `# Get Feature Version

Get the feature version information supported by the device.

## Function Description
- Returns device firmware version
- Shows list of supported features
- Used for feature compatibility determination

## Parameters
- No parameters required

## Return Value
- Major version (uint8)
- Minor version (uint8)
- Revision version (uint16)`
            }
        };

        document.addEventListener('DOMContentLoaded', () => {
            const languageButtons = document.querySelectorAll('.language-btn');
            const commandSelect = document.getElementById('command-select');
            const docContainer = document.getElementById('command-display-container');
            const debugPanel = document.getElementById('debug-panel');
            
            let currentLanguage = localStorage.getItem('language') || 'zh';
            let currentCommand = null;
            
            // Set initial language state
            languageButtons.forEach(btn => {
                btn.classList.toggle('active', btn.dataset.lang === currentLanguage);
            });
            
            // Language toggle functionality
            languageButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    const newLang = btn.dataset.lang;
                    if (newLang !== currentLanguage) {
                        currentLanguage = newLang;
                        localStorage.setItem('language', newLang);
                        
                        // Update button states
                        languageButtons.forEach(b => {
                            b.classList.toggle('active', b.dataset.lang === newLang);
                        });
                        
                        // Refresh current command documentation if available
                        if (currentCommand) {
                            displayCommandDocumentation(currentCommand, newLang);
                        }
                        
                        updateDebugInfo(`Language switched to: ${newLang}`);
                    }
                });
            });
            
            // Command selection
            commandSelect.addEventListener('change', (e) => {
                const commandId = e.target.value;
                if (commandId && mockCommands[commandId]) {
                    currentCommand = mockCommands[commandId];
                    displayCommandDocumentation(currentCommand, currentLanguage);
                    updateDebugInfo(`Command selected: ${commandId}`);
                } else {
                    currentCommand = null;
                    docContainer.innerHTML = '<p>请选择一个命令查看文档</p>';
                    updateDebugInfo('No command selected');
                }
            });
            
            function displayCommandDocumentation(command, lang = currentLanguage) {
                updateDebugInfo(`displayCommandDocumentation called: ${command.hex_id}, lang: ${lang}`);
                
                let description = '';
                if (lang === 'zh' && command.description_zh) {
                    description = command.description_zh;
                    updateDebugInfo('Using Chinese description');
                } else if (lang === 'en' && command.description_en) {
                    description = command.description_en;
                    updateDebugInfo('Using English description');
                } else {
                    description = command.description_zh || command.description_en || '暂无说明。';
                    updateDebugInfo('Using fallback description');
                }
                
                docContainer.innerHTML = marked.parse(description);
            }
            
            function updateDebugInfo(message) {
                const timestamp = new Date().toLocaleTimeString();
                debugPanel.innerHTML += `[${timestamp}] ${message}<br>`;
                debugPanel.scrollTop = debugPanel.scrollHeight;
                console.log(message);
            }
            
            updateDebugInfo(`Initialized with language: ${currentLanguage}`);
        });
    </script>
</body>
</html>
